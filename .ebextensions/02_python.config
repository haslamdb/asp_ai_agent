option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: unified_server:app
    NumProcesses: 1
    NumThreads: 15

commands:
  01_create_swap:
    command: |
      # Create 2GB swap file to help with package installation
      if [ ! -f /var/swapfile ]; then
        dd if=/dev/zero of=/var/swapfile bs=1M count=2048
        chmod 600 /var/swapfile
        mkswap /var/swapfile
        swapon /var/swapfile
      fi
    ignoreErrors: true
  02_upgrade_pip:
    command: |
      source /var/app/venv/*/bin/activate
      # Upgrade to setuptools 68+ for Python 3.12 compatibility
      pip install --upgrade pip
      pip install --upgrade 'setuptools>=68.0.0' wheel
